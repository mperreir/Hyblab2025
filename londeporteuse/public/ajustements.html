<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/style1.css">
    <title>Festival Budget</title>
</head>
<body>
    <div id="app-container">
      <header>
        <!-- Logo SVG minimaliste -->
        <div class="logo-only">
          <!-- Exemple d'un SVG placeholder -->
          <svg width="60" height="60" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="40" fill="#0066cc" />
            <text x="50" y="57" fill="#fff" text-anchor="middle" font-size="20" font-family="Arial">LOGO</text>
          </svg>
        </div>
      </header>
      <main>
        <div>
  <section class="content">
    <p class="content-title">€ Mon budget</p>
  </section>
  <section class="content">
    <h2>LES SUBVENTIONS DE LA Région ont été supprimées, à vous d’ajuster votre budget en vous passant de l’argent public.</h2>
  </section>
  <section class="content">
    <img src="img/picto1.jpg" alt="Image picto1" class="img">
    <p class="content-title">Quelle taille pour mon festival ?</p>
    <div class="button-container">
      <button class="btn-choice">
        <img src="img/option1.jpg" alt="Option 1">
      </button>
      <button class="btn-choice">
        <img src="img/option2.jpg" alt="Option 2">
      </button>
      <button class="btn-choice">
        <img src="img/option3.jpg" alt="Option 3">
      </button>
    </div>
  </section>
  <section class="content">
    <img src="img/picto2.jpg" alt="Image picto2" class="img">
    <p class="content-title">Quelles actions pour la transition écologique ?</p>
    <div class="button-container">
      <button class="btn-choice">
        <img src="img/option1.jpg" alt="Option 1">
      </button>
      <button class="btn-choice">
        <img src="img/option2.jpg" alt="Option 2">
      </button>
      <button class="btn-choice">
        <img src="img/option3.jpg" alt="Option 3">
      </button>
    </div>
  </section>
  <section class="content">
    <img src="img/picto3.jpg" alt="Image picto3" class="img">
    <p class="content-title">Quelles actions pour la médiation culturelle ?</p>
    <p class="content-texte">Je souhaite faciliter l’accès à la culture en organisant divers ateliers ouverts à
      tous.tes.</p>
    <div class="button-container">
      <button class="btn-choice">
        <img src="img/option1.jpg" alt="Option 1">
      </button>
      <button class="btn-choice">
        <img src="img/option2.jpg" alt="Option 2">
      </button>
      <button class="btn-choice">
        <img src="img/option3.jpg" alt="Option 3">
      </button>
    </div>
  </section>
  <section class="content">
    <img src="img/picto4.jpg" alt="Image picto4" class="img">
    <p class="content-title">Quelles actions pour la prévention des risques ?</p>
    <p class="content-texte">Je veille à l'accessibilité et à la sécurité de tous.tes lors de mon évènement.</p>
    <div class="button-container">
      <button class="btn-choice">
        <img src="img/option1.jpg" alt="Option 1">
      </button>
      <button class="btn-choice">
        <img src="img/option2.jpg" alt="Option 2">
      </button>
      <button class="btn-choice">
        <img src="img/option3.jpg" alt="Option 3">
      </button>
    </div>
  </section>
  <section class="content">
    <p class="content-title">Ajustez le prix du billet pour équilibrer votre budget.</p>
  </section>
  <a href="affiche.html" class="btn btn-next">Voir mes résultats</a>
</div>
      </main>

      <footer>
        <p>En partenariat avec <strong>L’Onde Porteuse</strong> &amp; <strong>Le Pôle</strong></p>
      </footer>
    </div>

    <script>
        // Chemin du fichier JSON
        const jsonFilePath = 'data/PAGE3.json';

        // Charger les données JSON depuis le serveur
        async function loadJSON() {
            try {
                const response = await fetch(jsonFilePath);
                if (!response.ok) {
                    throw new Error(`Échec du chargement du fichier JSON depuis ${jsonFilePath}`);
                }
                const data = await response.json();
                console.log("Données JSON chargées :", data); // Vérifier les données JSON chargées
                return data;
            } catch (error) {
                console.error("Erreur lors du chargement des données JSON :", error);
            }
        }

        // Générer dynamiquement le contenu
        function generateContent(sectionName, data) {
            const container = document.createElement("section");
            container.classList.add("content");

            const title = document.createElement("p");
            title.classList.add("content-title");
            title.textContent = getTitleForSection(sectionName);
            container.appendChild(title);

            const buttonContainer = document.createElement("div");
            buttonContainer.classList.add("button-container");

            data.forEach(item => {
                const button = document.createElement("button");
                button.classList.add("btn-choice");
                button.setAttribute("data-id", item.id);

                const img = document.createElement("img");
                img.src = item.image;
                img.alt = item.name;

                const label = document.createElement("p");
                label.textContent = item.name;

                button.appendChild(img);
                button.appendChild(label);
                buttonContainer.appendChild(button);

                // Ajouter un événement de clic
                button.addEventListener("click", async () => {
                    await updateSelection(sectionName, item.id);
                    refreshContent(sectionName, data);
                });
            });

            container.appendChild(buttonContainer);
            document.getElementById("dynamic-content").appendChild(container);
        }

        // Mettre à jour l'état de sélection
        async function updateSelection(sectionName, selectedId) {
            const data = await loadJSON();
            const sectionData = data[sectionName];
            if (!sectionData) return;

            // Mettre à jour l'état "isSelected"
            sectionData.forEach(item => {
                item.isSelected = item.id === selectedId;
            });

            // Enregistrer les données mises à jour sur le serveur
            await saveJSON(data);
            console.log(`${sectionName} mis à jour :`, sectionData);
        }

        // Enregistrer les données JSON sur le serveur
        async function saveJSON(data) {
            await fetch(jsonFilePath, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
        }

        // Rafraîchir le contenu pour afficher l'état sélectionné
        function refreshContent(sectionName, data) {
            const section = document.querySelector(`[data-section="${sectionName}"]`);
            if (!section) return;

            const buttons = section.querySelectorAll(".btn-choice");
            buttons.forEach(button => {
                const id = button.getAttribute("data-id");
                const isSelected = data.find(item => item.id === id)?.isSelected;
                button.classList.toggle("selected", isSelected);
            });
        }

        // Obtenir les titres des sections
        function getTitleForSection(sectionName) {
            const titles = {
                festivalSizes: "Quelle taille pour mon festival ?",
                ecologicalActions: "Quelles actions pour la transition écologique ?",
                culturalMediationActions: "Quelles actions pour la médiation culturelle ?",
                riskPreventionActions: "Quelles actions pour la prévention des risques ?"
            };
            return titles[sectionName] || "Section";
        }

        // Initialiser la page
        async function init() {
            try {
                const data = await loadJSON();

                // Générer dynamiquement chaque section
                generateContent("festivalSizes", data.festivalSizes);
                generateContent("ecologicalActions", data.ecologicalActions);
                generateContent("culturalMediationActions", data.culturalMediationActions);
                generateContent("riskPreventionActions", data.riskPreventionActions);
            } catch (error) {
                console.error("Erreur lors de l'initialisation de la page :", error);
            }
        }

        // Initialiser une fois que la page est chargée
        document.addEventListener("DOMContentLoaded", init);
    </script>
</body>
</html>
